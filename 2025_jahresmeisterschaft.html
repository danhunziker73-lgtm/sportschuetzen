<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jahresmeisterschaft 2025</title>

<style>
  :root {
    --primary: #0f3a5d;
    --bg: #f6f7f8;
    --text: #333;
    --accent: #2980b9;
  }

  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--bg);
    margin: 0;
    padding: 20px;
    color: var(--text);
  }

  .container { max-width: 1000px; margin: 0 auto; }

  h1 { margin-bottom: 5px; color: var(--primary); }
  .subtitle { color: #666; margin-bottom: 30px; }

  .liga {
    margin-bottom: 40px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    overflow: hidden;
  }

  .liga h2 {
    background: var(--primary);
    color: white;
    margin: 0;
    padding: 15px 20px;
    font-size: 1.2rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th {
    background: #f8f9fa;
    color: #666;
    font-size: 0.8rem;
    text-transform: uppercase;
    padding: 12px;
    text-align: left;
    border-bottom: 2px solid #eee;
  }

  td {
    padding: 12px;
    border-bottom: 1px solid #eee;
  }

  tr.clickable { transition: 0.2s; cursor: pointer; }
  tr.clickable:hover { background: #f0f6fb; }

  .rang-cell { font-weight: bold; color: var(--accent); width: 40px; }
  .name-cell { font-weight: 500; }
  .total-cell { font-weight: bold; text-align: right; padding-right: 30px; }
  
  /* Prozent-Zusatz im Total-Feld */
  .pct-hint { 
    display: block; 
    font-size: 0.75rem; 
    color: #888; 
    font-weight: normal; 
  }

  .details { display: none; background: #fafafa; }
  .details-box {
    padding: 15px 40px;
    border-left: 4px solid var(--accent);
    margin: 5px 15px;
  }

  .details ul { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px; }
  .details li { font-size: 0.9rem; padding: 4px 0; border-bottom: 1px solid #f0f0f0; }

  .badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 5px;
    text-transform: uppercase;
  }
  .liegend { background: #d8ecff; color: #004a80; }
  .kniend { background: #ffe4cc; color: #8a3b00; }

  @media (max-width: 600px) {
    .details ul { grid-template-columns: 1fr; }
  }
</style>
</head>

<body>
<div class="container">
  <h1>Jahresmeisterschaft 2025</h1>
  <div class="subtitle">Sportschützen Muhen – Klick auf Name für Details</div>
  <div id="content">Lade Daten...</div>
</div>

<script>
const API_URL = "https://jahresmeisterschaft-muhen.dan-hunziker73.workers.dev";

function renderLiga(ligaNr, teilnehmer) {
  if (!teilnehmer || teilnehmer.length === 0) return "";

  let html = `
    <div class="liga">
      <h2>Liga ${ligaNr}</h2>
      <table>
        <thead>
          <tr>
            <th class="rang-cell">Rang</th>
            <th>Name</th>
            <th>Jg.</th>
            <th style="text-align: right; padding-right: 30px;">Resultat (Total / %)</th>
          </tr>
        </thead>
        <tbody>
  `;

  teilnehmer.forEach((t, i) => {
    const detailId = `liga${ligaNr}_d${i}`;
    
    // Zahlen sauber formatieren (runden)
    const totalRaw = parseFloat(t.total) || 0;
    const totalDisplay = totalRaw.toFixed(1);
    const pctDisplay = t.prozent ? parseFloat(t.prozent).toFixed(2) : "0.00";

    html += `
      <tr class="clickable" onclick="toggle('${detailId}')">
        <td class="rang-cell">${t.rang}</td>
        <td class="name-cell">${t.name}</td>
        <td>${t.jahrgang ?? ""}</td>
        <td class="total-cell">
          ${totalDisplay}
          <span class="pct-hint">${pctDisplay}%</span>
        </td>
      </tr>
      <tr id="${detailId}" class="details">
        <td colspan="4">
          <div class="details-box">
            <strong>Einzelresultate:</strong>
            <ul>
              ${t.schiessen.map(s => `
                <li>
                  ${s.name}: <b>${s.punkte}</b>
                  ${s.stellung ? `<span class="badge ${s.stellung.toLowerCase()}">${s.stellung}</span>` : ""}
                </li>
              `).join('')}
            </ul>
          </div>
        </td>
      </tr>
    `;
  });

  html += `</tbody></table></div>`;
  return html;
}

function toggle(id) {
  const el = document.getElementById(id);
  const isVisible = el.style.display === "table-row";
  el.style.display = isVisible ? "none" : "table-row";
}

fetch(API_URL)
  .then(r => r.json())
  .then(data => {
    document.getElementById("content").innerHTML = 
      renderLiga(1, data.liga1) + 
      renderLiga(2, data.liga2);
  })
  .catch(err => {
    console.error(err);
    document.getElementById("content").innerHTML = "<b>Fehler beim Laden der Daten.</b>";
  });
</script>
</body>
</html>
