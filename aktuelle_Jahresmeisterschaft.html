<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jahresmeisterschaft 2025</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6f7f8;
  margin: 0;
  padding: 30px;
}

h1 {
  margin-bottom: 5px;
}

.subtitle {
  color: #666;
  margin-bottom: 30px;
}

.liga {
  margin-bottom: 50px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

thead {
  background: #0f3a5d;
  color: white;
}

th, td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid #e6e6e6;
}

th {
  font-weight: 600;
}

tr.clickable:hover {
  background: #f0f6fb;
  cursor: pointer;
}

.details {
  display: none;
  background: #fafafa;
}

.details td {
  padding: 15px 20px;
}

.details ul {
  margin: 0;
  padding-left: 20px;
}

.details li {
  margin-bottom: 4px;
}

.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  margin-left: 6px;
}

.liegend {
  background: #d8ecff;
  color: #004a80;
}

.kniend {
  background: #ffe4cc;
  color: #8a3b00;
}
</style>
</head>

<body>

<h1>Jahresmeisterschaft 2025</h1>
<div class="subtitle">2 Ligen – Klick auf einen Namen für Details</div>

<div id="content"></div>

<script>
/*
  ERWARTETES DATENFORMAT (kommt aus Apps Script!)
  ------------------------------------------------
  data = {
    liga1: [ {...}, {...} ],
    liga2: [ {...}, {...} ]
  }
*/

function renderLiga(ligaNr, teilnehmer) {

  let html = `
    <div class="liga">
      <h2>Liga ${ligaNr}</h2>
      <table>
        <thead>
          <tr>
            <th>Rang</th>
            <th>Name</th>
            <th>Jg.</th>
            <th>Total</th>
            <th>%</th>
          </tr>
        </thead>
        <tbody>
  `;

  teilnehmer.forEach((t, i) => {

    const detailId = `liga${ligaNr}_d${i}`;

    html += `
      <tr class="clickable" onclick="toggle('${detailId}')">
        <td>${t.rang}</td>
        <td>${t.name}</td>
        <td>${t.jahrgang ?? ""}</td>
        <td>${t.total ?? ""}</td>
        <td>${t.prozent ?? ""}</td>
      </tr>

      <tr id="${detailId}" class="details">
        <td colspan="5">
          <ul>
    `;

    t.schiessen.forEach(s => {
      html += `
        <li>
          ${s.name}: ${s.punkte}
          ${s.prozent ? `(${s.prozent}%)` : ""}
          ${s.stellung ? `<span class="badge ${s.stellung}">${s.stellung}</span>` : ""}
        </li>
      `;
    });

    html += `
          </ul>
        </td>
      </tr>
    `;
  });

  html += `
        </tbody>
      </table>
    </div>
  `;

  return html;
}

function toggle(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === "table-row" ? "none" : "table-row";
}

/* ============================================================
   DATENÜBERGABE – HIER WIRD SPÄTER Apps Script ANGEBUNDEN
   ============================================================ */

google.script.run
  .withSuccessHandler(data => {
    const container = document.getElementById("content");
    container.innerHTML =
      renderLiga(1, data.liga1) +
      renderLiga(2, data.liga2);
  })
  .withFailureHandler(err => {
    console.error(err);
    document.getElementById("content").innerText =
      "Fehler beim Laden der Daten";
  })
  .getJahresmeisterschaft();

google.script.run
  .withSuccessHandler(data => {
    const container = document.getElementById("content");
    container.innerHTML =
      renderLiga(1, data.liga1) +
      renderLiga(2, data.liga2);
  })
  .withFailureHandler(err => {
    console.error(err);
    document.getElementById("content").innerText =
      "Fehler beim Laden der Daten";
  })
  .getJahresmeisterschaft();
