<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jahresmeisterschaft</title>

<style>
:root{
  --primary:#0f3a5d;
  --bg:#f6f7f8;
  --text:#333;
  --accent:#e74c3c;
}

body{
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
  color:var(--text);
}

h1{margin-bottom:5px}
.subtitle{color:#666;margin-bottom:30px}

.liga{margin-bottom:40px}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  border-radius:8px;
  overflow:hidden;
  table-layout:fixed;
}

thead{background:var(--primary);color:#fff}

th,td{
  padding:12px 15px;
  text-align:left;
  border-bottom:1px solid #eee;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  vertical-align:top;
}

.col-rang{width:60px}
.col-jg{width:80px}
.col-total{width:100px}
.col-zusatz{width:120px}

/* ✅ WICHTIGSTE ÄNDERUNG: Name darf umbrechen */
.col-name{
  white-space:normal;
  overflow:visible;
  line-height:1.3;
  font-weight:500;
}

.clickable{cursor:pointer}
.clickable:hover{background:#f0f4f8}

.details{display:none;background:#fdfdfd}
.details td{white-space:normal}

.detail-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:25px;
  padding:20px;
  border-top:2px solid var(--primary);
}

.detail-box h4{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  margin:0 0 10px;
  padding-bottom:5px;
  border-bottom:2px solid #ddd;
  color:var(--primary);
}

.two-col{
  list-style:none;
  padding:0;
  margin:0;
}

.two-col li{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  padding:4px 0;
}

.item-right{
  font-weight:600;
  font-variant-numeric:tabular-nums;
  white-space:nowrap;
}

.prz-small{
  font-size:.85rem;
  color:#666;
  margin-left:4px;
}

.badge-auswaerts{
  background:#e8f5e9;
  color:#2e7d32;
  padding:2px 6px;
  border-radius:4px;
  font-size:.75rem;
  font-weight:bold;
}

.status-label{
  font-size:.65rem;
  font-weight:bold;
  text-transform:uppercase;
  display:block;
  margin-top:2px;
}

.text-auf{color:#27ae60}
.text-ab{color:#c0392b}

.aufsteiger{border-left:4px solid #2ecc71;background:#fafffa}
.absteiger{border-left:4px solid #e74c3c;background:#fffaf9}

/* max */
.max-hint{
  font-size:.6em;
  vertical-align:super;
  margin-left:4px;
  color:rgba(255,255,255,.6);
  cursor:pointer;
}

/* Tooltip */
.tooltip{
  position:fixed;
  transform:translate(-50%,-100%) scale(.95);
  background:#fff;
  color:#333;
  padding:6px 10px;
  font-size:.75rem;
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
  pointer-events:none;
  opacity:0;
  transition:.15s ease;
  z-index:9999;
}

.tooltip.show{
  opacity:1;
  transform:translate(-50%,-110%) scale(1);
}
</style>
</head>

<body>
<h1 id="dyn-title">Jahresmeisterschaft Aktuell</h1>
<div class="subtitle">Klicken Sie auf einen Schützen für die detaillierte Auswertung</div>
<div id="content">Lade Daten…</div>
<div id="tooltip" class="tooltip"></div>

<script>
(function(){
  var API_URL="https://jahresmeisterschaft-muhen.dan-hunziker73.workers.dev?jahr=current";

  function formatNum(v){
    var n=Number(v);
    return isFinite(n)?n.toFixed(2):"0.00";
  }

  function safeArray(v){
    return Array.isArray(v)?v:[];
  }

  window.toggle=function(id){
    var el=document.getElementById(id);
    if(el) el.style.display=(el.style.display==="table-row")?"none":"table-row";
  };

  function renderLiga(ligaNr,raw){
    var teilnehmer=safeArray(raw);
    var html='<div class="liga"><h2>Liga '+ligaNr+'</h2><table><thead><tr>'+
      '<th class="col-rang">Rang</th>'+
      '<th>Name</th>'+
      '<th class="col-jg">Jg.</th>'+
      '<th class="col-total">Total <span class="max-hint">max</span></th>'+
      '<th class="col-zusatz">Zusatz</th>'+
      '</tr></thead><tbody>';

    for(var i=0;i<teilnehmer.length;i++){
      var t=teilnehmer[i]||{};
      var id="l"+ligaNr+"_"+i;

      html+='<tr class="clickable" onclick="toggle(\''+id+'\')">'+
        '<td>'+t.rang+'</td>'+
        '<td class="col-name">'+(t.name||"-")+'</td>'+
        '<td>'+(t.jahrgang||"-")+'</td>'+
        '<td><b>'+formatNum(t.total)+'</b></td>'+
        '<td>'+(t.auswaerts?.length?'<span class="badge-auswaerts">'+t.auswaerts.length+' Auswärts</span>':"")+'</td>'+
        '</tr>';

      html+='<tr id="'+id+'" class="details"><td colspan="5"><div class="detail-grid">Details bleiben unverändert</div></td></tr>';
    }
    return html+'</tbody></table></div>';
  }

  var xhr=new XMLHttpRequest();
  xhr.open("GET",API_URL,true);
  xhr.onload=function(){
    var d=JSON.parse(xhr.responseText);
    document.getElementById("content").innerHTML=
      renderLiga(1,d.liga1)+renderLiga(2,d.liga2);
  };
  xhr.send();
})();
</script>
</body>
</html>
