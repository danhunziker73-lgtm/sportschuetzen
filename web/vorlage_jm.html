<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jahresmeisterschaft 2026</title>

<style>
:root{
  --primary:#0f3a5d;
  --bg:#f6f7f8;
  --text:#333;
  --accent:#e74c3c;
}

body{
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
  color:var(--text);
}

h1{margin-bottom:5px}
.subtitle{color:#666;margin-bottom:30px}

.liga{margin-bottom:40px}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  border-radius:8px;
  overflow:hidden;
  table-layout:fixed;
}

thead{background:var(--primary);color:#fff}

th,td{
  padding:12px 15px;
  text-align:left;
  border-bottom:1px solid #eee;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.col-rang{width:60px}
.col-jg{width:80px}
.col-total{width:100px}
.col-zusatz{width:120px}

.clickable{cursor:pointer}
.clickable:hover{background:#f0f4f8}

.details{display:none;background:#fdfdfd}
.details td{white-space:normal}

/* ---- max hint ---- */
.max-hint{
  font-size:.6em;
  vertical-align:super;
  margin-left:4px;
  color:rgba(255,255,255,.6);
  cursor:pointer;
}

/* ---- tooltip ---- */
.tooltip{
  position:fixed;
  transform:translate(-50%,-100%) scale(.95);
  background:#fff;
  color:#333;
  padding:6px 10px;
  font-size:.75rem;
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
  pointer-events:none;
  opacity:0;
  transition:opacity .15s ease, transform .15s ease;
  z-index:9999;
}

.tooltip.show{
  opacity:1;
  transform:translate(-50%,-110%) scale(1);
}
</style>
</head>

<body>
<h1>Jahresmeisterschaft 2025</h1>
<div class="subtitle">Klicken Sie auf einen Schützen für die detaillierte Auswertung</div>
<div id="content">Lade Daten…</div>

<div id="tooltip" class="tooltip"></div>

<script>
(function(){
  var API_URL = "https://jahresmeisterschaft-muhen.dan-hunziker73.workers.dev?jahr=2026";

  function formatNum(v){
    var n=Number(v);
    return isFinite(n)?n.toFixed(2):"0.00";
  }

  function safeArray(v){
    return Object.prototype.toString.call(v)==="[object Array]"?v:[];
  }

  window.toggle=function(id){
    var el=document.getElementById(id);
    if(!el)return;
    el.style.display=(el.style.display==="table-row")?"none":"table-row";
  };

  function renderLiga(ligaNr,raw){
    var teilnehmer=safeArray(raw);
    var html='<div class="liga"><h2>Liga '+ligaNr+'</h2><table><thead><tr>'+
      '<th class="col-rang">Rang</th><th>Name</th><th class="col-jg">Jg.</th>'+
      '<th class="col-total">Total <span class="max-hint">max</span></th>'+
      '<th class="col-zusatz">Zusatz</th>'+
      '</tr></thead><tbody>';

    for(var i=0;i<teilnehmer.length;i++){
      var t=teilnehmer[i]||{};
      var sch=safeArray(t.schiessen);
      var ma=safeArray(t.mannschaft);
      var au=safeArray(t.auswaerts);
      var streichPrz=Number(t.streichresultat_prz);
      var used=false;

      var id="liga"+ligaNr+"_"+i;

      html+='<tr class="clickable" onclick="toggle(\''+id+'\')">'+
        '<td><b>'+(t.rang??"-")+'</b></td>'+
        '<td>'+(t.name??"-")+'</td>'+
        '<td>'+(t.jahrgang??"-")+'</td>'+
        '<td><b>'+formatNum(t.total)+'</b></td>'+
        '<td>'+(au.length?'<span class="badge-auswaerts">'+au.length+' Auswärts</span>':"")+'</td>'+
        '</tr>';

      html+='<tr id="'+id+'" class="details"><td colspan="5"></td></tr>';
    }

    return html+'</tbody></table></div>';
  }

  var xhr=new XMLHttpRequest();
  xhr.open("GET",API_URL,true);
  xhr.onreadystatechange=function(){
    if(xhr.readyState!==4)return;
    if(xhr.status!==200)return;

    var data=JSON.parse(xhr.responseText);
    var MAX=data.max;

    document.getElementById("content").innerHTML=
      renderLiga(1,data.liga1)+renderLiga(2,data.liga2);

    var tooltip=document.getElementById("tooltip");

    document.querySelectorAll(".max-hint").forEach(function(el){
      function show(){
        var r=el.getBoundingClientRect();
        tooltip.textContent="Maximum: "+MAX;
        tooltip.style.left=r.left+r.width/2+"px";
        tooltip.style.top=r.top+"px";
        tooltip.classList.add("show");
      }
      function hide(){
        tooltip.classList.remove("show");
      }

      el.addEventListener("mouseenter",show);
      el.addEventListener("mouseleave",hide);
      el.addEventListener("click",function(e){
        e.stopPropagation();
        show();
      });
    });

    document.addEventListener("click",function(){
      tooltip.classList.remove("show");
    });
  };
  xhr.send();
})();
</script>
</body>
</html>
